[TheusCore] Registry GC: No cleanup needed. All records alive?
DEBUG: SupervisorProxy.__setattr__ path='domain.counter' tx_present=true
DEBUG: SupervisorProxy.__setattr__ path='domain.counter' tx_present=true
[TheusCore] Registry GC: No cleanup needed. All records alive?
DEBUG: SupervisorProxy.__setattr__ path='domain.nested.secret' tx_present=false
[TheusCore] Registry GC: No cleanup needed. All records alive?
[TheusCore] Registry GC: No cleanup needed. All records alive?

--- TEST 1: APP DEVELOPER API (ctx) ---
[ManagedAllocator] Registry initialized successfully.
1. Initial State: 10, <SupervisorProxy[dict] at path='domain.nested'>
   [Process] Read ctx.domain.counter: 10
   [Process] Mutated local ctx.domain.counter -> 11
   [Process] Mutated local ctx.domain.nested['a'] -> 999
DEBUG: Local Read of counter: 12
2. Final State:   12, <SupervisorProxy[dict] at path='domain.nested'>
✅ SUCCESS: Nested mutation persisted correctly (Deep Persistence).

--- TEST 2: SYSTEM API SAFETY (Legacy vs Proxy) ---
[ManagedAllocator] Registry initialized successfully.
A. Testing Legacy API (state.domain)...
   Type: <class 'theus_core.SupervisorProxy'>
   ✅ Shallow Mutation BLOCKED: PURE process cannot write
   Attempting Deep Mutation (Legacy Backdoor)...
   Unexpected block: PURE process cannot write

B. Testing Supervisor API (state.domain_proxy)...
   Type: <class 'theus_core.SupervisorProxy'>
   Attempting Deep Mutation (Supervisor Guard)...
   ✅ Supervisor BLOCKED Deep Mutation: Supervisor blocked mutation to 'domain.nested.secret': No active transaction found. State is Immutable outside processes.
   ✅ State Integrity Preserved.

--- TEST 3: STRICT CAS MODE ---
A. Smart CAS (strict_cas=False)
[ManagedAllocator] Registry initialized successfully.
   Attempting update 'a' with STALE version 1 (Current: 2)...
   ✅ Smart CAS ALLOWED update (Non-conflicting key).

B. Strict CAS (strict_cas=True)
[ManagedAllocator] Registry initialized successfully.
   Attempting update 'a' with STALE version 1 (Current: 2)...
   ✅ Strict CAS REJECTED update (Version Mismatch): Strict CAS Mismatch: Expected 1, Found 2 (Strict CAS Enabled)
